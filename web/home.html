
<!DOCTYPE html>
<html ng-app="myapp">
	<head>

		<!-- Basic -->
		<meta charset="utf-8">
		<meta name="keywords" content="HTML5 Template" />
		<meta name="description" >
		<meta name="author" content="pixelgeeklab.com">

		<!-- Mobile Metas -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Web Fonts  
		
		<link href='css/css.css' rel='stylesheet' type='text/css'>-->
		<link rel="stylesheet" href="fonts/font.css">
		
		<link href='fonts/Poppins.css' rel='stylesheet' type='text/css'>
		<link href='css/box.css' rel='stylesheet' type='text/css'>
		
		
		<!-- Vendor CSS -->
		<link rel="stylesheet" href="vendor/fontawesome/css/font-awesome.css">
		<link rel="stylesheet" href="vendor/owlcarousel/owl.carousel.css" media="screen">
		<link rel="stylesheet" href="vendor/owlcarousel/owl.theme.css" media="screen">
		<link href="vendor/owl-carousel/owl.transitions.html" rel="stylesheet" media="screen">
		<link rel="stylesheet" href="vendor/flexslider/flexslider.css" media="screen">
		<link rel="stylesheet" href="vendor/chosen/chosen.css" media="screen">
		<link rel="stylesheet" href="vendor/magnific-popup/magnific-popup.css" media="screen">

		<!-- Theme CSS -->
		<link rel="stylesheet" href="css/theme.css">
		<link rel="stylesheet" href="css/theme-animate.css">

        
		<!-- Style Switcher-->

		<!-- Head libs -->
		<script src="vendor/modernizr/modernizr.js"></script>

		<!--[if IE]>
			<link rel="stylesheet" href="css/ie.css">
		<![endif]-->

		<!--[if lte IE 8]>
			<script src="vendor/respond/respond.js"></script>
			<script src="vendor/excanvas/excanvas.js"></script>
		<![endif]-->

        <style>
            .page-wrap {
                max-width: 75rem;
                margin: 0 auto;
            }

            h1 {

                font-size: 1.5rem;
                letter-spacing: -1px;
                margin: 1.25rem 0;
            }

            input:focus ~ label, textarea:focus ~ label, input:valid ~ label, textarea:valid ~ label {
                font-size: 0.75em;

                top: -2.25rem;
                -webkit-transition: all 0.125s ease;
                transition: all 0.125s ease;
            }

            .styled-input {
                left:10px;
                width: 90%;
                margin: 2rem 0 1rem;
                position: relative;
            }

            .styled-input label {
                color: #999;
                padding: 1rem;
                position: absolute;
                top: 0;
                left: 0;
                -webkit-transition: all 0.25s ease;
                transition: all 0.25s ease;
                pointer-events: none;
            }
            input,
            textarea {
                position: relative;
                height: 2.9em;
                border: 0px solid #bebebe;
                border-bottom-width: 1px;
                width: 100%;
            }

            input ~ span,
            textarea ~ span {
                display: block;
                width: 0;
                height:1px;
                background: #03a3e8;
                position: absolute;
                bottom: 0;
                left: 0;
                -webkit-transition: all 0.125s ease;
                transition: all 0.125s ease;
            }

            input:focus,
            textarea:focus { outline: 0; }

            input:focus ~ span,
            textarea:focus ~ span {
                width: 100%;
                -webkit-transition: all 0.075s ease;
                transition: all 0.075s ease;
            }

            textarea {
                width: 100%;
                min-height: 15em;
            }


			/* Floating button */
#chatbot-button {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #00b7ffff;
  color: white;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  cursor: pointer;
  box-shadow: 0px 4px 10px rgba(0,0,0,0.3);
  z-index: 999;
}

/* Chatbot box */
#chatbot-box {
  position: fixed;
  bottom: 90px;
  right: 20px;
  width: 360px;
  height: 600px;
  background: #ffffffff;
  border-radius: 12px;
  box-shadow: 0px 4px 15px rgba(0,0,0,0.3);
  display: none;
  flex-direction: column;
  overflow: hidden;
  animation: slideUp 0.3s ease;
  z-index: 1000;
}

@keyframes slideUp {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* Header */
.chatbot-header {
  background: #00b7ffff;
  color: white;
  padding: 10px;
  font-weight: bold;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chatbot-header button {
  background: transparent;
  border: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
}

/* Messages */
.chatbot-messages {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
  font-size: 14px;
}

.message {
  margin: 5px 0;
  padding: 8px 12px;
  border-radius: 10px;
  max-width: 75%;
  display: inline-block;
  clear: both;
}

.message.bot {
  background: #eeeeeeff;
   float: left;
  align-self: flex-start;
}

.message.user {
  background: #00b7ffff;
 color: white;
  float: right;
  border-bottom-right-radius: 0;
}

/* Input */
.chatbot-input {
  display: flex;
  border-top: 1px solid #ddd;
}

.chatbot-input input {
  flex: 1;
  border: none;
  padding: 10px;
  outline: none;
}

.chatbot-input button {
  background: #00b7ffff;
  color: white;
  border: none;
  padding: 10px 15px;
  cursor: pointer;
}



.home-grid {
  margin-top: 30px;
  text-align: center;
}

.home-card {
  display: block;
  background: #fff;
  border-radius: 16px;
  padding: 25px 15px;
  margin: 15px;
  text-align: center;
  text-decoration: none;
  color: #333;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  height: 180px;
}

.home-card i {
  font-size: 4rem;
  margin-bottom: 0px;
}

.home-card h3 {
  font-size: 1.9rem;
  font-weight: 600;
  margin-bottom: 5px;
}

.home-card p {
  font-size: 1.7rem;
  color: #4b4b4bff;
  font-weight:700;
}

.home-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

/* Gradient backgrounds for each card */
.home-card.complaint {
  background: linear-gradient(135deg, #6a11cb, #2575fc);
  color: #fff;
}
.home-card.status {
  background: linear-gradient(135deg, #ff512f, #dd2476);
  color: #fff;
}
.home-card.profile {
  background: linear-gradient(135deg, #11998e, #38ef7d);
  color: #fff;
}
.home-card.admin {
  background: linear-gradient(135deg, #fc4a1a, #f7b733);
  color: #fff;
}

.home-card:hover {
  transform: translateY(-8px) scale(1.02);
}


        </style>

		

<!-- script back button -->
		<script src="cordova.js"></script>
		<script>

	
  
		function onLoad() 
		{
			document.addEventListener("deviceready", deviceReady, false);
		}
		function deviceReady() 
		{
			document.addEventListener("backbutton", backButtonCallback, false);
		}
		function backButtonCallback() 
		{
		//	navigator.app.backHistory();
		}
		</script>

	
	<!-- angular js -->
	<script src="js/angular-1.3.js"></script>
	<script src="js/angular_cookies.js"></script>

<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />

</head>
<body ng-controller="myappCtrl"  style="background-color: #FEFBE7" >
		<div class="body">
			<header id="header">
				<div class="header-top" style="height:8em;">
					<div class="container">
						<a href="#offcanvas" class="uk-navbar-toggle" style="float:left; margin:50px 5px 10px 5px;" data-uk-offcanvas>
							<span class="sr-only">Toggle navigation</span>
							<i class="fa fa-bars"></i>
						</a>
                        <nav>
							<ul class="nav nav-pills nav-top nav-top-left">
								<div class="head">Online Complaint App </div>
							</ul>
							<ul class="nav nav-pills nav-top nav-top-right">
								<li class="login">
									
								</li>
							</ul>
                        </nav>
					</div>	
				</div>
			</header>
		
				
		</div>

		<div id="offcanvas" class="uk-offcanvas">
            <div class="uk-offcanvas-bar">
				<ul id="main-menu-offcanvas" class="uk-nav-offcanvas" data-uk-nav>
					<h2 style="color:#000;padding:1.5em;font-weight:bold;font-family:Quicksand;"></h2>
					<span class="uk-parent">
						<a href="home.html"><img src="images/icons/house.png" class="fa icon"> &nbsp;&nbsp;&nbsp;Home</a>
					</span>
                   
                   
                    <span class="uk-parent">
						<a style="cursor:pointer" ng-click="user_logout()" >
						<img src="images/icons/smartphone-2.png" class="fa icon"> &nbsp;&nbsp;&nbsp;Logout</a>
					</span>
				</ul>
			</div>
		</div>
		
	<div class="content" style="margin-top:3em">
		<div class="container">
		
            <div class="col-md1 simpleCart_shelfItem">

                <div style="font-weight: 100;font-size: 1.6em ;text-align: center;color: #000000" >
				User Home</div>
            </div>

		
<!-- HOMe UI============================================= -->
				<div  class="howit">

				<div class="section nobg mt-4 mb-0 pb-0">
					<div class="container">
						<div class="heading-block nobottomborder center divcenter mb-0 clearfix" style="max-width: 550px">

						</div>
					<div  class="deskContent  ">
				

						<div class="row home-grid">
  <div class="col-sm-6 col-md-3">
    <a href="post_complaint.html" class="home-card complaint">
      <i class="fa fa-pencil-square-o"></i>
      <h3>Complaint</h3>
      <p>Raise a new complaint easily</p>
    </a>
  </div>

  <div class="col-sm-6 col-md-3">
    <a href="view_complaint.html" class="home-card status">
      <i class="fa fa-list-alt"></i>
      <h3>Status</h3>
      <p>Check your complaint progress</p>
    </a>
  </div>

  <div class="col-sm-6 col-md-3">
    <a href="user_update_info.html" class="home-card profile">
      <i class="fa fa-user"></i>
      <h3>My Profile</h3>
      <p>Update your profile info</p>
    </a>
  </div>

  <div class="col-sm-6 col-md-3">
    <a href="view_admin_contact.html" class="home-card admin">
      <i class="fa fa-headphones"></i>
      <h3>Admin Info</h3>
      <p>Contact admin for support</p>
    </a>
  </div>
</div>


						<!-- Chatbot Button -->
						<div id="chatbot-button">
						<i class="fa fa-comments"></i>
						</div>

						<!-- Chatbot Box -->
						<div id="chatbot-box">
						<div class="chatbot-header">
							<span>Complaint Chatbot </span>
							<button id="close-chatbot">&times;</button>
						</div>
						<div class="chatbot-messages">
						</div>
						<div class="chatbot-input">
							<input type="text" id="chatbot-text" placeholder="Type your message..." />
							<button id="send-btn">Send</button>
						</div>
						</div>
						
					</div>
				</div>
				</div>
				</div>
			<!-- ============================================ -->

          
			</div>		
				
		</div>

		<script src="vendor/jquery/jquery.js"></script>
		<script src="vendor/bootstrap/bootstrap.js"></script>
		<script src="vendor/jquery.validation/jquery.validation.js"></script>
		<script src="vendor/owlcarousel/owl.carousel.js"></script>
		<script src="vendor/flexslider/jquery.flexslider-min.js"></script>
		<script src="vendor/countdown/countdown.min.js"></script>
		<script src="vendor/chosen/chosen.jquery.min.js"></script>
		<script src="vendor/pricefilter/jquery.pricefilter.js"></script>
		<script src="vendor/masonry/imagesloaded.pkgd.min.js"></script>
		<script src="vendor/masonry/masonry.pkgd.min.js"></script>
		<script src="vendor/uikit/uikit.js"></script>
		<script src="vendor/magnific-popup/jquery.magnific-popup.js"></script>
		
		<!-- Theme Base, Components and Settings -->
		<script src="js/theme.js"></script>
		
		<!-- Style Switcher -->
		<script type="text/javascript" src="style-switcher/js/switcher.js"></script>
		
	<!-- angular js -->
	<script src="js/angular_data.js"></script>
	<body onload="onLoad()">		 
<script>
document.addEventListener("DOMContentLoaded", function () {
  const chatbotBtn = document.getElementById("chatbot-button");
  const chatbotBox = document.getElementById("chatbot-box");
  const closeChat = document.getElementById("close-chatbot");
  const sendBtn = document.getElementById("send-btn");
  const msgContainer = document.querySelector(".chatbot-messages");
  const input = document.getElementById("chatbot-text");
  const LOGGED_IN_EMAIL = sessionStorage.getItem("userEmail") || "";
  const LOGGED_IN_NAME  = sessionStorage.getItem("userName") || "";
  let chatState = "menu"; // default state

  const FAQ = [
    {
      q: "How to raise a complaint?",
      a: "‚û° By clicking on the Complaint tab on your Home page. It will redirect to the Create Complaint page where you enter the details and post the complaint."
    },
    {
      q: "How long does it take to resolve complaints?",
      a: "‚û° It usually takes less than 7 to 10 days. If it‚Äôs more than 10 days, you can contact the admin."
    },
    {
      q: "How can I see the status of a complaint?",
      a: "‚û° By entering option 1 in chatbot or typing 'complaint no 35' (for example). You can also use the 'Complaint Status' tab on the Home page, where you can see details and images."
    }
  ];

  // === Initial Greeting ===
  if (LOGGED_IN_NAME) {
    addBotMessageDelayed("üëã Hi " + LOGGED_IN_NAME + "! How can I help you?");
  } else {
    addBotMessageDelayed("üëã Hi! How can I help you?");
  }

  // store history
  let history = [];
  let historyIndex = -1;

  // ===== Utility Functions =====
  function addUserMessage(text) {
    const userMsg = document.createElement("div");
    userMsg.className = "message user";
    userMsg.innerText = text;
    msgContainer.appendChild(userMsg);
    msgContainer.scrollTop = msgContainer.scrollHeight;
  }

  function addBotMessage(text) {
    const botMsg = document.createElement("div");
    botMsg.className = "message bot";
    botMsg.innerText = text;
    msgContainer.appendChild(botMsg);
    msgContainer.scrollTop = msgContainer.scrollHeight;
  }

  function addBotMessageDelayed(text, delay = 650) {
    setTimeout(() => {
      addBotMessage(text);
    }, delay);
  }

  function handleMyComplaints(userEmail) {
    fetch("complaint_getbyuser.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: userEmail })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success == 1 && data.complaints.length > 0) {
        let reply = "üìã Your Complaints:\n\n";
        data.complaints.forEach(c => {
          reply +=
            "üÜî ID: " + c.cus_id + "\n" +
            "üìù Issue: " + c.field_7 + "\n" +
            "üìå Status: " + c.field_9 + "\n" +
            "üìÖ Date: " + c.created_date + "\n\n";
        });
        addBotMessageDelayed(reply);
      } else {
        addBotMessageDelayed("‚ö†Ô∏è " + (data.message || "No complaints found."));
      }
    })
    .catch(err => {
      addBotMessageDelayed("‚ùå Error fetching complaints.");
    });
  }

  // ===== Bot Features =====
  function handleComplaintById(compNo) {
    fetch("complaint_getbyid.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ complaint_no: compNo })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success == 1 && data.details) {
        const c = data.details;

        // format main details
        let reply =
          "üìã Complaint #" + c.cus_id +
          "\nüìß Email: " + c.email +
          "\nüìù Issue: " + c.field_7 +
          "\n‚ö° Priority: " + c.field_8 +
          "\nüìå Status: " + c.field_9 +
          "\n‚ùì Reason: " + c.field_10 +
          "\n‚úÖ Solution: " + c.field_11 +
          "\nüìÖ Date: " + c.created_date;

        addBotMessageDelayed(reply);

        // === Extra logic ===
        if (c.field_9.toLowerCase() === "completed") {
          return; // ‚úÖ already completed
        }

        // Parse complaint date
        const complaintDate = new Date(c.created_date);
        const today = new Date();
        const diffDays = Math.floor((today - complaintDate) / (1000 * 60 * 60 * 24));

        if (diffDays < 10) {
          const remaining = 10 - diffDays;
          addBotMessageDelayed("‚åõ Your complaint will be approved or rejected within " + remaining + " days.");
        } else {
          addBotMessageDelayed("‚ö†Ô∏è Your complaint has been pending for over 10 days.\nWould you like to contact the admin? (yes/no)");
          chatState = "awaiting_admin_contact_decision";
        }
      } else {
        addBotMessageDelayed("‚ö†Ô∏è " + (data.message || "Complaint not found."));
      }
    })
    .catch(err => {
      addBotMessageDelayed("‚ùå Error fetching complaint.");
    });
  }

  function handleContact() {
    addBotMessageDelayed(
      "üìû Name: Admin\n‚úâÔ∏è Email: admin@gmail.com\nüì± Mobile: 1234567890"
    );
  }

  function handleDefault(text) {
    addBotMessageDelayed("ü§ñ You said: " + text);
  }

  function handleCustomCommands(text) {
    if (text.toLowerCase().startsWith("complaint no")) {
      const parts = text.split(" ");
      const compNo = parts[parts.length - 1];
      handleComplaintById(compNo);

    } else if (text.toLowerCase() === "contact") {
      handleContact();

    } else if (text.toLowerCase() === "my complaints") {
      if (LOGGED_IN_EMAIL) {
        handleMyComplaints(LOGGED_IN_EMAIL);
      } else {
        addBotMessageDelayed("‚ö†Ô∏è Please log in to see your complaints.");
      }

    } else {
      handleDefault(text);
    }
  }

  function isCustomCommand(text) {
    const lower = text.toLowerCase();
    return (
      lower.startsWith("complaint no") ||
      lower === "contact" ||
      lower === "my complaints"
    );
  }

  // ===== Main Send Message =====
  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    // save to history
    history.push(text);
    historyIndex = history.length;

    // add user msg
    addUserMessage(text);

    // reset input
    input.value = "";

    // === Step 1: Always check for custom commands first ===
    if (isCustomCommand(text)) {
      handleCustomCommands(text);
      chatState = "menu"; 
      return; 
    }

    // === Step 2: Menu-driven flow ===
    if (chatState === "menu") {
      addBotMessageDelayed(
        "Please choose an option:\n" +
        "1Ô∏è‚É£ Complaint Status\n" +
        "2Ô∏è‚É£ All Complaints\n" +
        "3Ô∏è‚É£ Contact Details\n" +
        "4Ô∏è‚É£ Help / FAQ"
      );
      chatState = "awaiting_choice";

    } else if (chatState === "awaiting_choice") {
      if (text === "1") {
        addBotMessageDelayed("Please enter your complaint number:");
        chatState = "awaiting_complaint_id";

      } else if (text === "2") {
        if (LOGGED_IN_EMAIL) {
          handleMyComplaints(LOGGED_IN_EMAIL);
        } else {
          addBotMessageDelayed("‚ö†Ô∏è Please log in to see your complaints.");
        }
        chatState = "menu";

      } else if (text === "3") {
        handleContact();
        chatState = "menu";

      } else if (text === "4" || text.toLowerCase() === "help" || text.toLowerCase() === "faq") {
        let reply = "üìñ Help / FAQ:\n";
        FAQ.forEach((item, index) => {
          reply += (index + 1) + ". " + item.q + "\n";
        });
        reply += "\nPlease enter the number of the question to see the answer.";
        addBotMessageDelayed(reply);
        chatState = "awaiting_faq_choice";

      } else {
        addBotMessageDelayed("‚ùå Invalid option. Please type 1, 2, 3, or 4.");
      }

    } else if (chatState === "awaiting_complaint_id") {
      handleComplaintById(text);
      chatState = "menu";

    } else if (chatState === "awaiting_admin_contact_decision") {
      if (text.toLowerCase() === "yes") {
        handleContact();
      } else {
        addBotMessageDelayed("üôè Thank you for your patience. Please visit again.");
      }
      chatState = "menu";

    } else if (chatState === "awaiting_faq_choice") {
      const choice = parseInt(text);
      if (!isNaN(choice) && choice >= 1 && choice <= FAQ.length) {
        addBotMessageDelayed(FAQ[choice - 1].a);
      } else {
        addBotMessageDelayed("‚ùå Invalid choice. Please enter a valid FAQ number.");
      }
      chatState = "menu";
    }
  }

  // ===== Events =====
  chatbotBtn.addEventListener("click", () => {
    chatbotBox.style.display = "flex";
    chatbotBtn.style.display = "none";
  });

  closeChat.addEventListener("click", () => {
    chatbotBox.style.display = "none";
    chatbotBtn.style.display = "flex";
  });

  sendBtn.addEventListener("click", sendMessage);

  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      sendMessage();
    } else if (e.key === "ArrowUp") {
      if (historyIndex > 0) {
        historyIndex--;
        input.value = history[historyIndex];
      }
      e.preventDefault();
    } else if (e.key === "ArrowDown") {
      if (historyIndex < history.length - 1) {
        historyIndex++;
        input.value = history[historyIndex];
      } else {
        historyIndex = history.length;
        input.value = "";
      }
      e.preventDefault();
    }
  });

});  
</script>




</body>
</html>